import{S as D,E as C,d as I,b as P,c as l,o as h,H as S,w as t,f as E,h as e,j as i,e as N,g as u,t as M,P as U,J as B,_ as q}from"./index-6a805337.js";import{d as F,u as K,a as O,b as j,c as H,e as J}from"./user-50fa25cb.js";import{u as L}from"./pagination-7089872e.js";import"./request-2be46003.js";function z(v){return{deleteRow:s=>{D.confirm("确认删除此用户吗？","确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{let{ID:r}=s;F({id:r}).then(()=>{C({type:"success",message:"删除成功"}),v()}).catch(()=>{})}).catch(()=>{})},setPassword:s=>{D.prompt("请输入新的密码","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:r})=>{K({id:s,password:r}).then(()=>{C({type:"success",message:"设置成功"})})}).catch(()=>{})},setStatus:s=>{const{Status:r,ID:w}=s;D.confirm(`确认${r==0?"启用":"禁用"}此用户吗？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{j({id:w,status:r==0?1:0}).then(()=>{C({type:"success",message:"操作成功"}),v()}).catch(()=>{})}).catch(()=>{})},setRemainingDialogueCount:s=>{D.prompt("设置用户对话次数","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:r})=>{O({id:s,count:r}).then(()=>{C({type:"success",message:"设置成功"}),v()})}).catch(()=>{})}}}const G={class:"dialog-footer"},Q=I({__name:"AddUsers",emits:["success"],setup(v,{expose:b,emit:x}){const m=P(!1),o=P({Username:"",Password:"",Status:0,IsAdmin:!1,RemainingDialogueCount:0}),s=()=>{m.value=!0,o.value={Username:"",Password:"",Status:0,IsAdmin:!1,RemainingDialogueCount:0}},r=()=>{H(o.value).then(w=>{C.success(`成功添加${w}个用户`),m.value=!1,x("success")})};return b({Show:s}),(w,a)=>{const V=l("el-input"),_=l("el-form-item"),f=l("el-radio"),k=l("el-radio-group"),y=l("el-input-number"),c=l("el-form"),p=l("el-button"),R=l("el-dialog");return h(),S(R,{modelValue:m.value,"onUpdate:modelValue":a[7]||(a[7]=n=>m.value=n),title:"添加用户",width:"70%",draggable:"","lock-scroll":"","close-on-click-modal":!1},{footer:t(()=>[E("span",G,[e(p,{onClick:a[5]||(a[5]=n=>m.value=!1)},{default:t(()=>[i("关闭")]),_:1}),e(p,{type:"primary",onClick:a[6]||(a[6]=n=>r())},{default:t(()=>[i(" 确认添加 ")]),_:1})])]),default:t(()=>[e(c,{model:o.value,"label-width":"120px","label-position":"top"},{default:t(()=>[e(_,{label:"用户名"},{default:t(()=>[e(V,{modelValue:o.value.Username,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.Username=n),type:"textarea",placeholder:"多个用户名请用英文逗号隔开,当有多个用户时，大家公用下面的属性"},null,8,["modelValue"])]),_:1}),e(_,{label:"状态"},{default:t(()=>[e(k,{modelValue:o.value.Status,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.Status=n)},{default:t(()=>[e(f,{label:0},{default:t(()=>[i("禁用")]),_:1}),e(f,{label:1},{default:t(()=>[i("启用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"是否是管理员"},{default:t(()=>[e(k,{modelValue:o.value.IsAdmin,"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.IsAdmin=n)},{default:t(()=>[e(f,{label:!1},{default:t(()=>[i("否")]),_:1}),e(f,{label:!0},{default:t(()=>[i("是")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"剩余对话次数"},{default:t(()=>[e(y,{modelValue:o.value.RemainingDialogueCount,"onUpdate:modelValue":a[3]||(a[3]=n=>o.value.RemainingDialogueCount=n)},null,8,["modelValue"])]),_:1}),e(_,{label:"密码"},{default:t(()=>[e(V,{modelValue:o.value.Password,"onUpdate:modelValue":a[4]||(a[4]=n=>o.value.Password=n),type:"password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),W={class:"box"},X=I({__name:"Index",setup(v){const{searchParams:b,tableData:x,paginationRef:m,setTableData:o,refreshTable:s,resetParams:r}=L(),{deleteRow:w,setPassword:a,setStatus:V,setRemainingDialogueCount:_}=z(s),f=P(),k=()=>{var y;(y=f.value)==null||y.Show()};return(y,c)=>{const p=l("el-button"),R=l("el-input"),n=l("ActionBar"),g=l("el-table-column"),$=l("el-table"),T=l("Pagination");return h(),N("div",W,[e(n,{onReset:u(r),onRefresh:u(s)},{left:t(()=>[e(p,{type:"primary",onClick:c[0]||(c[0]=d=>k())},{default:t(()=>[i("添加用户")]),_:1})]),right:t(()=>[e(R,{modelValue:u(b).keyword,"onUpdate:modelValue":c[1]||(c[1]=d=>u(b).keyword=d),placeholder:"请输入关键词",clearable:""},null,8,["modelValue"])]),_:1},8,["onReset","onRefresh"]),e($,{data:u(x),style:{width:"100%"},"max-height":"calc(100vh - 267px)"},{default:t(()=>[e(g,{prop:"ID",label:"ID"}),e(g,{prop:"Username",label:"Username"}),e(g,{prop:"IsAdmin",label:"是否是管理员"}),e(g,{prop:"TokenConsumed",label:"共消耗Token数"}),e(g,{prop:"RemainingDialogueCount",label:"剩余对话次数"}),e(g,{prop:"CreatedAt",label:"CreatedAt"}),e(g,{fixed:"right",label:"操作",width:"460"},{default:t(d=>[d.row.Username!=="Admin"?(h(),S(p,{key:0,type:d.row.Status==0?"success":"warning",onClick:U(A=>u(V)(d.row),["prevent"])},{default:t(()=>[i(M(d.row.Status==0?"启用":"禁用"),1)]),_:2},1032,["type","onClick"])):B("",!0),e(p,{type:"primary",onClick:U(A=>u(_)(d.row.ID),["prevent"])},{default:t(()=>[i(" 设置对话次数 ")]),_:2},1032,["onClick"]),d.row.Username!=="Admin"?(h(),S(p,{key:1,type:"danger",onClick:U(A=>u(w)(d.row),["prevent"])},{default:t(()=>[i(" 删除 ")]),_:2},1032,["onClick"])):B("",!0),e(p,{type:"warning",onClick:U(A=>u(a)(d.row.ID),["prevent"])},{default:t(()=>[i(" 重置密码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(T,{ref_key:"paginationRef",ref:m,params:u(b),reqFunc:u(J),onPageData:u(o)},null,8,["params","reqFunc","onPageData"]),e(Q,{ref_key:"showAddUsers",ref:f,onSuccess:c[2]||(c[2]=d=>u(s)())},null,512)])}}});const ae=q(X,[["__scopeId","data-v-2997ab7a"]]);export{ae as default};
