import{S as k,E as w,d as B,b as A,c as s,o as h,H as P,w as t,f as T,h as e,j as d,e as E,g as r,t as N,P as D,J as S,_ as M}from"./index-e8372f18.js";import{d as q,u as F,a as K,b as O,c as j,e as H}from"./user-f66cba89.js";import{u as J}from"./pagination-1cb3fb51.js";import"./request-88389718.js";function L(v){return{deleteRow:l=>{k.confirm("确认删除此用户吗？","确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{let{ID:u}=l;q({id:u}).then(()=>{w({type:"success",message:"删除成功"}),v()}).catch(()=>{})}).catch(()=>{})},setPassword:l=>{k.prompt("请输入新的密码","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:u})=>{F({id:l,password:u}).then(()=>{w({type:"success",message:"设置成功"})})}).catch(()=>{})},setStatus:l=>{const{Status:u,ID:f}=l;k.confirm(`确认${u==0?"启用":"禁用"}此用户吗？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{O({id:f,status:u==0?1:0}).then(()=>{w({type:"success",message:"操作成功"}),v()}).catch(()=>{})}).catch(()=>{})},setRemainingDialogueCount:l=>{k.prompt("设置用户对话次数","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:u})=>{K({id:l,count:u}).then(()=>{w({type:"success",message:"设置成功"}),v()})}).catch(()=>{})}}}const z={class:"dialog-footer"},G=B({__name:"AddUsers",emits:["success"],setup(v,{expose:C,emit:x}){const m=A(!1),n=A({Username:"",Password:"",Status:0,IsAdmin:!1,RemainingDialogueCount:0}),l=()=>{m.value=!0,n.value={Username:"",Password:"",Status:0,IsAdmin:!1,RemainingDialogueCount:0}},u=()=>{j(n.value).then(f=>{w.success(`成功添加${f}个用户`),m.value=!1,x("success")})};return C({Show:l}),(f,o)=>{const y=s("el-input"),p=s("el-form-item"),_=s("el-radio"),V=s("el-radio-group"),b=s("el-input-number"),g=s("el-form"),c=s("el-button"),U=s("el-dialog");return h(),P(U,{modelValue:m.value,"onUpdate:modelValue":o[7]||(o[7]=a=>m.value=a),title:"添加用户",width:"70%",draggable:"","lock-scroll":"","close-on-click-modal":!1},{footer:t(()=>[T("span",z,[e(c,{onClick:o[5]||(o[5]=a=>m.value=!1)},{default:t(()=>[d("关闭")]),_:1}),e(c,{type:"primary",onClick:o[6]||(o[6]=a=>u())},{default:t(()=>[d(" 确认添加 ")]),_:1})])]),default:t(()=>[e(g,{model:n.value,"label-width":"120px","label-position":"top"},{default:t(()=>[e(p,{label:"用户名"},{default:t(()=>[e(y,{modelValue:n.value.Username,"onUpdate:modelValue":o[0]||(o[0]=a=>n.value.Username=a),type:"textarea",placeholder:"多个用户名请用英文逗号隔开,当有多个用户时，大家公用下面的属性"},null,8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(V,{modelValue:n.value.Status,"onUpdate:modelValue":o[1]||(o[1]=a=>n.value.Status=a)},{default:t(()=>[e(_,{label:0},{default:t(()=>[d("禁用")]),_:1}),e(_,{label:1},{default:t(()=>[d("启用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"是否是管理员"},{default:t(()=>[e(V,{modelValue:n.value.IsAdmin,"onUpdate:modelValue":o[2]||(o[2]=a=>n.value.IsAdmin=a)},{default:t(()=>[e(_,{label:!1},{default:t(()=>[d("否")]),_:1}),e(_,{label:!0},{default:t(()=>[d("是")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"剩余对话次数"},{default:t(()=>[e(b,{modelValue:n.value.RemainingDialogueCount,"onUpdate:modelValue":o[3]||(o[3]=a=>n.value.RemainingDialogueCount=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"密码"},{default:t(()=>[e(y,{modelValue:n.value.Password,"onUpdate:modelValue":o[4]||(o[4]=a=>n.value.Password=a),type:"password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Q={class:"box"},W=B({__name:"Index",setup(v){const{searchParams:C,tableData:x,paginationRef:m,setTableData:n,refreshTable:l,resetParams:u}=J(),{deleteRow:f,setPassword:o,setStatus:y,setRemainingDialogueCount:p}=L(l),_=A(),V=()=>{var b;(b=_.value)==null||b.Show()};return(b,g)=>{const c=s("el-button"),U=s("ActionBar"),a=s("el-table-column"),I=s("el-table"),$=s("Pagination");return h(),E("div",Q,[e(U,{onReset:r(u),onRefresh:r(l)},{left:t(()=>[e(c,{type:"primary",onClick:g[0]||(g[0]=i=>V())},{default:t(()=>[d("添加用户")]),_:1})]),right:t(()=>[]),_:1},8,["onReset","onRefresh"]),e(I,{data:r(x),style:{width:"100%"},"max-height":"calc(100vh - 267px)"},{default:t(()=>[e(a,{prop:"ID",label:"ID"}),e(a,{prop:"Username",label:"Username"}),e(a,{prop:"IsAdmin",label:"是否是管理员"}),e(a,{prop:"TokenConsumed",label:"共消耗Token数"}),e(a,{prop:"RemainingDialogueCount",label:"剩余对话次数"}),e(a,{prop:"CreatedAt",label:"CreatedAt"}),e(a,{fixed:"right",label:"操作",width:"460"},{default:t(i=>[i.row.Username!=="Admin"?(h(),P(c,{key:0,type:i.row.Status==0?"success":"warning",onClick:D(R=>r(y)(i.row),["prevent"])},{default:t(()=>[d(N(i.row.Status==0?"启用":"禁用"),1)]),_:2},1032,["type","onClick"])):S("",!0),e(c,{type:"primary",onClick:D(R=>r(p)(i.row.ID),["prevent"])},{default:t(()=>[d(" 设置对话次数 ")]),_:2},1032,["onClick"]),i.row.Username!=="Admin"?(h(),P(c,{key:1,type:"danger",onClick:D(R=>r(f)(i.row),["prevent"])},{default:t(()=>[d(" 删除 ")]),_:2},1032,["onClick"])):S("",!0),e(c,{type:"warning",onClick:D(R=>r(o)(i.row.ID),["prevent"])},{default:t(()=>[d(" 重置密码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e($,{ref_key:"paginationRef",ref:m,params:r(C),reqFunc:r(H),onPageData:r(n)},null,8,["params","reqFunc","onPageData"]),e(G,{ref_key:"showAddUsers",ref:_,onSuccess:g[1]||(g[1]=i=>r(l)())},null,512)])}}});const te=M(W,[["__scopeId","data-v-22c9c15e"]]);export{te as default};
