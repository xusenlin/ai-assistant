import{S as x,E as h,d as B,b as S,c as s,o as D,H as I,w as t,f as M,h as e,j as d,e as N,g as r,t as A,P as U,J as $,_ as O}from"./index-aadf96f9.js";import{d as j,u as q,a as F,b as H,c as K,e as L}from"./user-5d8a4197.js";import{u as J}from"./pagination-29e0a812.js";import"./request-195fb5bd.js";function z(v){return{deleteRow:u=>{x.confirm("确认删除此用户吗？","确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{let{ID:i}=u;j({id:i}).then(()=>{h({type:"success",message:"删除成功"}),v()}).catch(()=>{})}).catch(()=>{})},setPassword:u=>{x.prompt("请输入新的密码","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:i})=>{q({id:u,password:i}).then(()=>{h({type:"success",message:"设置成功"})})}).catch(()=>{})},setStatus:u=>{const{Status:i,ID:f}=u;x.confirm(`确认${i==0?"启用":"禁用"}此用户吗？`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"关闭",type:"warning"}).then(()=>{H({id:f,status:i==0?1:0}).then(()=>{h({type:"success",message:"操作成功"}),v()}).catch(()=>{})}).catch(()=>{})},setRemainingDialogueCount:u=>{x.prompt("设置用户对话次数","提示",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(({value:i})=>{F({id:u,count:i}).then(()=>{h({type:"success",message:"设置成功"}),v()})}).catch(()=>{})}}}const G={class:"dialog-footer"},Q=B({__name:"AddUsers",emits:["success"],setup(v,{expose:b,emit:C}){const c=S(!1),l=S({Username:"",Password:"",Status:1,IsAdmin:!1,RemainingDialogueCount:0}),u=()=>{c.value=!0,l.value={Username:"",Password:"",Status:1,IsAdmin:!1,RemainingDialogueCount:0}},i=()=>{K(l.value).then(f=>{let a=Object.keys(f.error),g=f.success||[],m=a.length===0?`<p>成功导入${g.length}个用户</p>`:`<p>成功导入${g.length}个用户</p>
        <p>导入失败${a.length}个用户：</p>
        <div style="display: flex;flex-wrap: wrap;">${a.map(p=>`<span>${p}</span>`)}</div>
        `;x.alert(m,"提示",{dangerouslyUseHTMLString:!0}),c.value=!1,C("success")})};return b({Show:u}),(f,a)=>{const g=s("el-input"),m=s("el-form-item"),p=s("el-radio"),V=s("el-radio-group"),y=s("el-input-number"),_=s("el-alert"),w=s("el-form"),k=s("el-button"),P=s("el-dialog");return D(),I(P,{modelValue:c.value,"onUpdate:modelValue":a[7]||(a[7]=o=>c.value=o),title:"添加用户",width:"70%",draggable:"","lock-scroll":"","close-on-click-modal":!1},{footer:t(()=>[M("span",G,[e(k,{onClick:a[5]||(a[5]=o=>c.value=!1)},{default:t(()=>[d("关闭")]),_:1}),e(k,{type:"primary",onClick:a[6]||(a[6]=o=>i())},{default:t(()=>[d(" 确认添加 ")]),_:1})])]),default:t(()=>[e(w,{model:l.value,"label-width":"120px","label-position":"top"},{default:t(()=>[e(m,{label:"用户名"},{default:t(()=>[e(g,{modelValue:l.value.Username,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.Username=o),type:"textarea",placeholder:"用户名是唯一的，多个用户名请用英文逗号隔开,当有多个用户时，大家公用下面的属性"},null,8,["modelValue"])]),_:1}),e(m,{label:"状态"},{default:t(()=>[e(V,{modelValue:l.value.Status,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.Status=o)},{default:t(()=>[e(p,{label:0},{default:t(()=>[d("禁用")]),_:1}),e(p,{label:1},{default:t(()=>[d("启用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"是否是管理员"},{default:t(()=>[e(V,{modelValue:l.value.IsAdmin,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.IsAdmin=o)},{default:t(()=>[e(p,{label:!1},{default:t(()=>[d("否")]),_:1}),e(p,{label:!0},{default:t(()=>[d("是")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"剩余对话次数"},{default:t(()=>[e(y,{modelValue:l.value.RemainingDialogueCount,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.RemainingDialogueCount=o)},null,8,["modelValue"])]),_:1}),e(m,{label:"密码"},{default:t(()=>[e(_,{title:"密码为空时，此用户登录时需要激活(设置密码)才能登录系统",type:"warning","show-icon":"",closable:!1}),e(g,{style:{"margin-top":"20px"},modelValue:l.value.Password,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.Password=o),type:"password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),W={class:"box"},X=B({__name:"Index",setup(v){const{searchParams:b,tableData:C,paginationRef:c,setTableData:l,refreshTable:u,resetParams:i}=J(),{deleteRow:f,setPassword:a,setStatus:g,setRemainingDialogueCount:m}=z(u),p=S(),V=()=>{var y;(y=p.value)==null||y.Show()};return(y,_)=>{const w=s("el-button"),k=s("el-input"),P=s("ActionBar"),o=s("el-table-column"),T=s("el-table"),E=s("Pagination");return D(),N("div",W,[e(P,{onReset:r(i),onRefresh:r(u)},{left:t(()=>[e(w,{type:"primary",onClick:_[0]||(_[0]=n=>V())},{default:t(()=>[d("添加用户")]),_:1})]),right:t(()=>[e(k,{modelValue:r(b).keyword,"onUpdate:modelValue":_[1]||(_[1]=n=>r(b).keyword=n),placeholder:"请输入关键词",clearable:""},null,8,["modelValue"])]),_:1},8,["onReset","onRefresh"]),e(T,{data:r(C),style:{width:"100%"},"max-height":"calc(100vh - 267px)"},{default:t(()=>[e(o,{prop:"ID",label:"ID"}),e(o,{prop:"Username",label:"Username"}),e(o,{prop:"IsAdmin",label:"是否是管理员"},{default:t(n=>[d(A(n.row.IsAdmin?"是":"否"),1)]),_:1}),e(o,{prop:"TokenConsumed",label:"共消耗Token数"}),e(o,{prop:"RemainingDialogueCount",label:"剩余对话次数"}),e(o,{prop:"Password",label:"是否已经激活"},{default:t(n=>[d(A(n.row.Password?"是":"否"),1)]),_:1}),e(o,{prop:"CreatedAt",label:"CreatedAt"}),e(o,{fixed:"right",label:"操作",width:"460"},{default:t(n=>[n.row.Username!=="Admin"?(D(),I(w,{key:0,type:n.row.Status==0?"success":"warning",onClick:U(R=>r(g)(n.row),["prevent"])},{default:t(()=>[d(A(n.row.Status==0?"启用":"禁用"),1)]),_:2},1032,["type","onClick"])):$("",!0),e(w,{type:"primary",onClick:U(R=>r(m)(n.row.ID),["prevent"])},{default:t(()=>[d(" 设置对话次数 ")]),_:2},1032,["onClick"]),n.row.Username!=="Admin"?(D(),I(w,{key:1,type:"danger",onClick:U(R=>r(f)(n.row),["prevent"])},{default:t(()=>[d(" 删除 ")]),_:2},1032,["onClick"])):$("",!0),e(w,{type:"warning",onClick:U(R=>r(a)(n.row.ID),["prevent"])},{default:t(()=>[d(" 重置密码 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(E,{ref_key:"paginationRef",ref:c,params:r(b),reqFunc:r(L),onPageData:r(l)},null,8,["params","reqFunc","onPageData"]),e(Q,{ref_key:"showAddUsers",ref:p,onSuccess:_[2]||(_[2]=n=>r(u)())},null,512)])}}});const ae=O(X,[["__scopeId","data-v-4d4f011b"]]);export{ae as default};
